const bel = require('bel')
const csjs = require('csjs-inject')

function SupplyTree(ver, app, protocol) {
    const css = style
    let url = `${app.link}/dist/${ver}`
    // elements
    let contributorsList = bel`<div class="${css.contributors}"></div>`

    getVersion(`${url}/version.json`).then( data => {
        let contributors = data.supplytree.contributors
        contributors.map( file => getVersion(`${url}/${file.url}`).then( res => {
        let list = bel`
            <div class="${css.list}">
                <a href="${res.url}" target="_blank">
                    <div class=${css.avatar}>
                        <img src="${res.avatar}" alt="${res.name}">
                    </div>
                    <p class="${css.name}">${res.name}</p>
                </a>
            </div>
            `
        contributorsList.append(list)
        }))
    })

    async function getVersion(data) {
        return await fetch(data).then( res => res.json())
    }

    const el = bel`
    <section class=${css.supplytree}>
        <div class="${css.donate}">
            <h4 class="${css.subtitle}">Make this project, its dependencies and the community sustainable</h4>
            <a target="_blank" class="${css.btn}" href="https://opencollective.com/datdotorg">Open Collective</a>
            <a target="_blank" class="${css.btn}" href="https://gist.github.com/ninabreznik/f7414b57b2396ad131a216c918e5d9f4#file-donation-md">Cryptocurrency Donation</a>
        </div>
        <h1 class=${css.title}>Contributors</h1>
        ${contributorsList}
    </section>
    `

    return el
}

const style = csjs`
.supplytree {
    padding: 20px;
}
.donate {
    background-color:#DDD;
    padding: 10px 0 40px 0;
    text-align: center;
}
.title {
    text-align: center;
}
.subtitle {
    font-size: 1.8rem;
}
.text {
    font-size: 1.2rem;
}
.address {
    font-size: 1.2rem;
}
.btn {
    background-color: #000;
    border-radius: 4px;
    padding: 8px 16px;
    color: #fff;
    text-decoration: none;
    font-size: 1.9rem;
    font-weight: bold;
    font-family: 'Comic Sans MS', Arial, sans;
    transition: color .3s, background-color .3s ease-out;
}
.btn:hover {
    color: #fff;
    background-color: rgb(26, 13, 171);
}
.btn-small {
    display: inline-block;
    margin-top: 5px;
    padding: 2px 8px 4px 8px;
    font-size: 1.2rem;
    font-weight: normal;
}
.btn-small:hover {
    background-color: rgb(20, 155, 1);
}
.name {
    font-size: 1.2rem;
    margin:0;
}
.contributors {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(auto, 130px));
    justify-content: center;
    padding-bottom: 8vh;
}
.avatar {
    max-width: 80px;
    height: 80px;
    margin-bottom: 10px;
}
.contributors a {
    text-decoration: none;
    display: grid;
    justify-items: center;
}
`

module.exports = SupplyTree
