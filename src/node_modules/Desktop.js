const bel = require('bel')
const csjs = require('csjs-inject')
// widgets
const Graphic = require('Graphic')

function Desktop(package, protocol, done) {
    // console.log(package);
    let css = style
    // title is for window's css using
    const title = package.title.split(' ').join('').toLowerCase()
    const url  = `${package.link}/dist/${package.versions.latest}`
    // appTitle is for desktop app list using
    var appTitle = package.title 
    // icon default 
    var icon = bel`<div class=${css.icon}><img src="${url}/${package.icon}"></div>`

    if ( package.icon.includes('svg') ) {
        icon = Graphic(`${url}/${package.icon}`, css.icon)
    }

    // Only app is not installed 
    if (package.status.app.install === false) {
        icon =  Graphic('./src/node_modules/assets/svg/application.svg', css.icon)
        appTitle = `${package.title}.install`
    }
    
    const el = bel`
    <div class="${css["app-icon"]} ${title}" onclick=${ () => protocol({ url: package.link, title}, package) }>
        ${icon}      
        <span class=${css['app-name']}>${appTitle}</span>
    </div>
    `

    return  done(null, el, title)
}



const style = csjs`
.app-icon {
    display: grid;
    grid-template-rows: 60px auto;
    text-align: center;
    justify-items: center;
    cursor: pointer;
    overflow: hidden;
    grid-gap: 7px 0;
    width: 100%;
}
.app-name {
    font-size: var(--appNameFontSize);
    color: var(--appNameColor);
    word-break: break-word;
}
.app-icon:hover .app-name {
    color: var(--appHoverColor);
    text-decoration: underline;
}
.icon {
    width: 60px;
}
`

module.exports = Desktop